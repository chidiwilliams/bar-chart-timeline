<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    <canvas id="canvas" width="1100" style="border: solid 1px #000;"></canvas>

    <script>
      const BAR_WIDTH = 1000;
      const BAR_MARGIN = 10;
      const BAR_HEIGHT = 40;
      const FONT_HEIGHT = 16;
      const BAR_LABEL_PADDING = 10;
      const FONT_STYLE = 'bold 16px Arial';
      const FRAME_INTERVAL = 1000;

      function drawGraph({ elements }) {
        const canvas = document.getElementById('canvas');
        canvas.height = calculateTotalCanvasHeight(elements.length);

        const sets = elements[0].length;
        for (let i = 0; i < sets; i++) {
          const delay = i * FRAME_INTERVAL;
          const values = getValuesForSet(elements, i);
          setTimeout(() => {
            const ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            drawCanvas(values, ctx);
          }, delay);
        }
      }

      function getValuesForSet(elements, setIndex) {
        return elements.map((element) => element[setIndex]);
      }

      function drawCanvas(values, ctx) {
        totalValue = getTotalValue(values);

        values.forEach((element, id) => {
          ctx.beginPath();
          const yMargin = (BAR_HEIGHT + BAR_MARGIN) * id;
          const barWidth = getBarWidth(element, totalValue, BAR_WIDTH);
          ctx.rect(0, yMargin, barWidth, BAR_HEIGHT);
          ctx.fill();

          ctx.textBaseline = 'top';
          ctx.font = FONT_STYLE;
          ctx.fillText(
            element,
            barWidth + BAR_LABEL_PADDING,
            yMargin + BAR_HEIGHT / 2 - FONT_HEIGHT / 2,
          );
        });
      }

      function getBarWidth(value, totalValue, maxBarWidth) {
        return (value / totalValue) * maxBarWidth;
      }

      function getTotalValue(vals) {
        let s = 0;
        for (let i = 0; i < vals.length; i++) {
          const v = vals[i];
          s += v;
        }
        return s;
      }

      function calculateTotalCanvasHeight(numElements) {
        return numElements * BAR_HEIGHT + (numElements - 1) * BAR_MARGIN;
      }

      drawGraph({ elements: [[40, 52, 38, 100], [12, 28, 92, 0]] });
    </script>
  </body>
</html>
